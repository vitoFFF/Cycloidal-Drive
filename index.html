<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Modern Roller Mechanism</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #2B313F;
            font-family: 'Arial', sans-serif;
            color: #dfdede;
            position: relative; /* Added for absolute positioning of headerText */
        }
        #headerText {
            text-align: center;
            width: 100%;
            padding: 15px 0;
            font-size: 24px;
            font-weight: bold;
            color: #d6d2d2;
            background-color: #1E2433;
            box-shadow: 0px 2px 4px rgba(0,0,0,0.1);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000;
        }

        #infoButton {
        position: absolute;
        right: 100px;
        top: 50%;
        transform: translateY(-50%);
        background-color: #1E2433;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        font-size: 16px;
        cursor: pointer;
    }

  


      

        #slidersPanel,
        #equationsPanel {
            width: 90%;
            max-width: 400px;
            background-color: #1E2433;
            padding: 20px;
            margin: 2px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(212, 209, 209, 0.164);
        }

        .slider-container {
            margin-bottom: 20px;
        }

        label {
            margin-bottom: 10px;
            font-weight: bold;
            display: block;
        }

        input[type="range"] {
            width: 100%;
            background-color: #a0a0a0;
            border: none;
            border-radius: 5px;
            height: 20px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #ff9800;
            cursor: pointer;
        }

        svg {
            display: block;
            border: 2px solid #33333300;
            border-radius: 10px;
            margin-top: 1px;
        }

        pre {
            margin: 0;
            white-space: pre-wrap;
            text-align: left;
            font-size: 14px;
        }

        #equationsPanel {
            height: 160px;
            background-color: #2B313F;
        }

        .download-button {
            background-color: #1E2433; /* Different color for buttons */
            border-color: #8c909b; /* Dark border color for buttons */
            color: rgb(216, 216, 216);
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
    
        }

        #container {
    display: flex;
    flex-direction: row; /* Keep as row layout */
    align-items: start; /* Align items to the start of the flex container */
    justify-content: flex-start; /* Align container content to the left */
    gap: 20px; /* Optional: add some space between the panels */
}

/* Responsive Text Sizes */
@media screen and (max-width: 600px) {
    body {
        font-size: 14px;
    }
}

/* Responsive SVG Size */
svg {
    width: 80vw; /* Adjusts width based on viewport width */
    height: auto; /* Maintains aspect ratio */
    max-width: 900px; /* Maximum width */
    max-height: 80vh; /* Maximum height */
}


    </style>
</head>
<body>
   
    <div id="headerText">
        CycloDrive
        <button id="infoButton">About</button>
    </div>
    

    <div id="container">
        
        <div id="slidersPanel">
            

            <h3 style="text-align: center; margin-bottom: 20px;">Adjust Parameters</h3>

            <div class="slider-container">
                <label for="radiusInput">Change R Value:</label>
                <input type="range" id="radiusInput" min="50" max="310" value="280">
                <span id="radiusValue">128</span>
            </div>

            <div class="slider-container">
                <label for="dInput">Change d Value:</label>
                <input type="range" id="dInput" min="1" max="33" value="14">
                <span id="dValue">4</span>
            </div>

            <div class="slider-container">
                <label for="eInput">Change e Value:</label>
                <input type="range" id="eInput" min="0.1" max="14" step="0.1" value="6">
                <span id="eValue">6</span>
            </div>

            <div class="slider-container">
                <label for="nInput">Change Number of Rollers (n):</label>
                <input type="range" id="nInput" min="1" max="20" value="10">
                <span id="nValue">10</span>
            </div>
            <div id="equationsPanel">
                <h3 style="text-align: center; margin-bottom: 10px;">Parametric Equations</h3>
                <pre id="equationsOutput"></pre>
            </div>
            <br /><br/>
       
            <button class="download-button" id="downloadButton">Download SVG</button>
        </div>
        
        
    </div>

    <svg id="rollerSvg"></svg>
    
    <script>
        
        const svg = document.getElementById('rollerSvg');
        const radiusInput = document.getElementById('radiusInput');
        const radiusValue = document.getElementById('radiusValue');
        const dInput = document.getElementById('dInput');
        const dValue = document.getElementById('dValue');
        const eInput = document.getElementById('eInput');
        const eValue = document.getElementById('eValue');
        const nInput = document.getElementById('nInput');
        const nValue = document.getElementById('nValue');
        const equationsOutput = document.getElementById('equationsOutput');

        let R = parseInt(radiusInput.value);
        let d = parseInt(dInput.value);
        let e = parseFloat(eInput.value);
        let n = parseInt(nInput.value);

        function resizeSvg() {
            const size = Math.min(window.innerWidth * 0.95, window.innerHeight * 0.95);

            svg.setAttribute('height', size);
            svg.setAttribute('width', 900);

            draw();
        }

        // function resizeSvg() {
        // const maxWidth = 900;
        // const maxHeight = 900;
        // const svgWidth = Math.min(window.innerWidth * 0.8, maxWidth);
        // const svgHeight = Math.min(window.innerHeight * 0.8, maxHeight);

        // svg.setAttribute('width', svgWidth + 'px');
        // svg.setAttribute('height', svgHeight + 'px');

        // draw();
        // }


        

        window.addEventListener('resize', resizeSvg);

        function drawDashedCircle(radius) {
            const dashedCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            dashedCircle.setAttribute('cx', svg.width.baseVal.value / 2);
            dashedCircle.setAttribute('cy', svg.height.baseVal.value / 2);
            dashedCircle.setAttribute('r', radius);
            dashedCircle.setAttribute('fill', 'none');
            dashedCircle.setAttribute('stroke', 'gray');
            dashedCircle.setAttribute('stroke-dasharray', '5 5');
            dashedCircle.setAttribute('stroke-width', '2');
            svg.appendChild(dashedCircle);
        }

        function drawRotor(t) {
            const psi = -Math.atan(Math.sin((1 - n) * t) / ((R / (e * n)) - Math.cos((1 - n) * t)));
            const x = R * Math.cos(t) - d * Math.cos(t - psi) - e * Math.cos(n * t) + e;
            const y = -R * Math.sin(t) + d * Math.sin(t - psi) + e * Math.sin(n * t);
            return `${x + svg.width.baseVal.value / 2},${y + svg.height.baseVal.value / 2}`;
        }

        function drawRoller(x, y) {
            const roller = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            roller.setAttribute('cx', x + svg.width.baseVal.value / 2);
            roller.setAttribute('cy', y + svg.height.baseVal.value / 2);
            roller.setAttribute('r', d);
            roller.setAttribute('fill', 'orange');
            roller.setAttribute('stroke', 'red');
            roller.setAttribute('stroke-width', '0');
            svg.appendChild(roller);
        }

        function draw() {
            svg.innerHTML = '';

            drawDashedCircle(R);

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute('fill', '#0B89F0');
            path.setAttribute('stroke', 'blue');
            path.setAttribute('stroke-width', '0');
            path.setAttribute('d', `M${drawRotor(0)} ${Array.from({ length: Math.ceil(2 * Math.PI / 0.01) }, (_, i) => drawRotor(i * 0.01)).join(' ')}`);
            svg.appendChild(path);

            for (let k = 1; k <= n; k++) {
                const angle = (2 * Math.PI / n) * k;
                const rollerX = R * Math.cos(angle);
                const rollerY = R * Math.sin(angle);
                drawRoller(rollerX, rollerY);
            }
        }

        radiusInput.addEventListener('input', () => {
            R = parseInt(radiusInput.value);
            radiusValue.textContent = R;
            draw();
            printEquations();
        });

        dInput.addEventListener('input', () => {
            d = parseInt(dInput.value);
            dValue.textContent = d;
            draw();
            printEquations();
        });

        eInput.addEventListener('input', () => {
            e = parseFloat(eInput.value);
            eValue.textContent = e;
            draw();
            printEquations();
        });

        nInput.addEventListener('input', () => {
            n = parseInt(nInput.value);
            nValue.textContent = n;
            draw();
            printEquations();
        });

        dInput.addEventListener('input', () => {
            const maxEValue = parseFloat(dInput.value) / 2;
            eInput.max = maxEValue;
            eValue.textContent = eInput.value;
            printEquations();
        });

        eInput.addEventListener('input', () => {
            const currentValue = parseFloat(eInput.value);
            eValue.textContent = currentValue;
            draw();
            printEquations();
        });

        const initialNValue = parseInt(nInput.value);
        nValue.textContent = initialNValue;

        const initialEValue = parseFloat(eInput.value);
        eValue.textContent = initialEValue;

        function printEquations() {
            equationsOutput.textContent = `
                x(t) = ${R} * cos(t) - ${d} * cos(t - psi) - ${e} * cos(${n} * t) + ${e}
                y(t) = -${R} * sin(t) + ${d} * sin(t - psi) + ${e} * sin(${n} * t)
                psi = -atan(sin((${1 - n}) * t) / (${R} / (${e} * ${n}) - cos((${1 - n}) * t)))
            `;
        }

        resizeSvg();
        printEquations(); // Initial display of equations

        // Function to download the entire SVG content
        function downloadRotorSvg(svgEl, name) {
            // Clone the SVG element
            let clonedSvg = svgEl.cloneNode(true);

            // Remove the dashed circle from the cloned SVG
            Array.from(clonedSvg.children).forEach(child => {
                if (child.tagName === 'circle' && child.getAttribute('stroke-dasharray')) {
                    clonedSvg.removeChild(child);
                }
            });

            // Serialize and download the modified SVG
            const svgData = new XMLSerializer().serializeToString(clonedSvg);
            const svgBlob = new Blob([svgData], {type: "image/svg+xml;charset=utf-8"});
            const svgUrl = URL.createObjectURL(svgBlob);
            const downloadLink = document.createElement("a");
            downloadLink.href = svgUrl;
            downloadLink.download = name;
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }

        // Event listener for the download button
        document.addEventListener('DOMContentLoaded', function() {
            const downloadButton = document.getElementById('downloadButton');
            downloadButton.addEventListener('click', () => {
                downloadRotorSvg(document.getElementById('rollerSvg'), 'complete_design.svg');
            });
        });

        // Event listener for the download button
        document.addEventListener('DOMContentLoaded', function() {
            const downloadButton = document.getElementById('downloadButton');
            downloadButton.addEventListener('click', () => {
                downloadRotorSvg(document.getElementById('rollerSvg'), 'complete_design.svg');
            });
        });

        // Create groups (layers) for different elements
        const rotorGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
        rotorGroup.setAttribute('id', 'rotorGroup');
        const rollerGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
        rollerGroup.setAttribute('id', 'rollerGroup');
        svg.appendChild(rotorGroup);
        svg.appendChild(rollerGroup);



        document.getElementById('infoButton').addEventListener('click', function() {
            alert("Information about CycloDrive...");
        });


    </script>
</body>
</html>
